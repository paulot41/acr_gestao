{% extends 'core/base.html' %}

{% block title %}Dashboard - {{ organization.name }} | ACR Gestão{% endblock %}

{% block extra_css %}
<style>
.dashboard-card {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 1rem;
    border: 1px solid #e9ecef;
}

.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
    padding: 1.5rem;
    border-radius: 8px;
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    display: block;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.table-responsive {
    max-height: 400px;
    overflow-y: auto;
}

.event-today {
    background-color: #e8f5e8;
    border-left: 4px solid #28a745;
}

.event-upcoming {
    background-color: #fff3cd;
    border-left: 4px solid #ffc107;
}

.low-credits {
    background-color: #f8d7da;
    border-left: 4px solid #dc3545;
}

.dashboard-title {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.quick-action-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    transition: all 0.2s;
    text-decoration: none;
    color: inherit;
}

.quick-action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    text-decoration: none;
    color: inherit;
}

.quick-action-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: #667eea;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Cabeçalho do Dashboard -->
    <div class="dashboard-title">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-1">
                    <i class="fas fa-tachometer-alt text-primary"></i>
                    Dashboard
                </h1>
                <p class="text-muted mb-0">
                    <i class="fas fa-building"></i> {{ organization.name }}
                </p>
            </div>
            <div class="text-end">
                <small class="text-muted">
                    <i class="fas fa-clock"></i>
                    Atualizado em {{ "now"|date:"d/m/Y H:i" }}
                </small>
            </div>
        </div>
    </div>

    <!-- Estatísticas Rápidas -->
    <div class="stat-grid">
        <div class="stat-card">
            <span class="stat-number">{{ stats.active_clients }}</span>
            <span class="stat-label">
                <i class="fas fa-users"></i> Clientes Ativos
            </span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ stats.active_instructors }}</span>
            <span class="stat-label">
                <i class="fas fa-chalkboard-teacher"></i> Instrutores Ativos
            </span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ stats.active_modalities }}</span>
            <span class="stat-label">
                <i class="fas fa-tags"></i> Modalidades Ativas
            </span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ events_today|length }}</span>
            <span class="stat-label">
                <i class="fas fa-calendar-day"></i> Eventos Hoje
            </span>
        </div>
    </div>

    <div class="row">
        <!-- Eventos de Hoje -->
        <div class="col-lg-6">
            <div class="dashboard-card">
                <h5 class="mb-3">
                    <i class="fas fa-calendar-day text-success"></i>
                    Eventos de Hoje
                </h5>
                {% if events_today %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Hora</th>
                                <th>Evento</th>
                                <th>Instrutor</th>
                                <th>Modalidade</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for event in events_today %}
                        <tr class="event-today">
                            <td><strong>{{ event.starts_at|time:"H:i" }}</strong></td>
                            <td>{{ event.title }}</td>
                            <td>{{ event.instructor.full_name }}</td>
                            <td><span class="badge bg-success">{{ event.modality.name }}</span></td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Sem eventos programados para hoje</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Próximos Eventos -->
        <div class="col-lg-6">
            <div class="dashboard-card">
                <h5 class="mb-3">
                    <i class="fas fa-calendar-week text-warning"></i>
                    Próximos Eventos
                </h5>
                {% if upcoming_events %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Data</th>
                                <th>Hora</th>
                                <th>Evento</th>
                                <th>Instrutor</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for event in upcoming_events %}
                        <tr class="event-upcoming">
                            <td>{{ event.starts_at|date:"d/m" }}</td>
                            <td>{{ event.starts_at|time:"H:i" }}</td>
                            <td>{{ event.title }}</td>
                            <td>{{ event.instructor.full_name }}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Sem eventos próximos programados</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Alertas e Ações Rápidas -->
    <div class="row">
        <!-- Clientes com Poucos Créditos -->
        <div class="col-lg-6">
            <div class="dashboard-card">
                <h5 class="mb-3">
                    <i class="fas fa-exclamation-triangle text-danger"></i>
                    Alertas de Créditos
                </h5>
                {% if low_credits %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tbody>
                        {% for client in low_credits %}
                        <tr class="low-credits">
                            <td>
                                <strong>{{ client.full_name }}</strong><br>
                                <small class="text-muted">{{ client.email }}</small>
                            </td>
                            <td class="text-end">
                                <span class="badge bg-danger">
                                    {{ client.total_credits|default:"0" }} crédito{{ client.total_credits|pluralize }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <p class="text-muted">Todos os clientes com créditos suficientes</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Ações Rápidas -->
        <div class="col-lg-6">
            <div class="dashboard-card">
                <h5 class="mb-3">
                    <i class="fas fa-bolt text-primary"></i>
                    Ações Rápidas
                </h5>
                <div class="quick-actions">
                    <a href="{% url 'core:event_add' %}" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <strong>Criar Evento</strong>
                    </a>
                    <a href="{% url 'core:client_add' %}" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <strong>Adicionar Cliente</strong>
                    </a>
                    <a href="{% url 'core:gantt' %}" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <strong>Ver Calendário</strong>
                    </a>
                    <a href="{% url 'core:booking_list' %}" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <strong>Gerir Reservas</strong>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
